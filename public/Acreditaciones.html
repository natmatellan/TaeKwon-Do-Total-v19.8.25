<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Acreditaciones - Combate Total</title>
  <style>
    body {
      background: #121212;
      font-family: sans-serif;
      color: #f5f5f5;
      margin: 0;
      padding: 2rem;
    }

    h1 {
      text-align: center;
      color: #39ff14;
      text-shadow: 0 0 10px #39ff14;
    }

    .resumen {
      text-align: center;
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .buscador {
      text-align: center;
      margin-bottom: 1rem;
    }

    .buscador input {
      padding: 0.5rem;
      font-size: 1rem;
      width: 300px;
      border-radius: 5px;
      border: none;
      outline: none;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #333;
      padding: 0.5rem;
      text-align: center;
    }

    th {
      background: #222;
      color: #39ff14;
    }

    tr.acreditado {
      background-color: rgba(57, 255, 20, 0.1);
      color: #9ccc65;
    }

    button {
      padding: 0.4rem 0.7rem;
      background: #39ff14;
      color: #000;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: bold;
    }

    button:disabled {
      background: #666;
      color: #aaa;
      cursor: not-allowed;
    }

    select {
      padding: 0.3rem;
      border-radius: 5px;
    }

    td[contenteditable="true"] {
      background-color: #1c1c1c;
      outline: none;
    }

 .contenedor-areas {
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  gap: 30px;
  margin-top: 20px;
}

.area-container {
  display: flex;
  flex-direction: column;
  align-items: center;
  width: 160px;
}

.area-box {
  width: 120px;
  height: 120px;
  border: 4px solid red;
  background: #1565c0;
  box-shadow: inset 0 0 0 4px #c62828;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  font-size: 1.5rem;
  color: white;
}

.area-list {
  list-style: none;
  padding: 0;
  margin: 10px 0 0;
  font-size: 0.9rem;
  color: #fff;
  text-align: left;
}
.area-list li {
  margin: 3px 0;
  text-shadow: 0 0 2px #000;
}


  </style>
</head>
<body>

<div style="text-align: center; margin-bottom: 1rem;">
  <button onclick="mostrarSeccion('acreditaciones')">Acreditaciones</button>
  <button onclick="mostrarSeccion('areas')">Áreas</button>
</div>

<div id="acreditaciones-section">
  <h1>Acreditaciones</h1>

  <div class="resumen" id="resumen">Acreditados: 0 / 0</div>

<div style="text-align: center; margin-bottom: 1rem;">
  <button onclick="importarDesdeSpreadsheet()">Importar desde Google Sheets</button>
</div>


  <div class="buscador">
    <input type="text" id="busqueda" placeholder="Buscar por nombre, coach, equipo...">
  </div>

  <table id="tabla">
    <thead>
      <tr>
        <th>N°</th>
        <th>Nombre y apellido</th>
        <th>Peso</th>
        <th>Altura</th>
        <th>HdS</th>
        <th>PdR</th>
        <th>Coach</th>
        <th>N° de Área</th>
        <th>Acreditar</th>
      </tr>
    </thead>
    <tbody id="tbody">
      <!-- Filas generadas dinámicamente -->
    </tbody>
  </table>
</div>

<div id="areas-section" style="display:none; text-align:center;">
  <h2>Áreas de Competencia</h2>
  <div style="display: flex; flex-wrap: wrap; justify-content: center; gap: 20px; margin-top: 20px;">
    <div class="area-container">
  <div class="area-box">Área 1</div>
  <ul class="area-list" id="lista-area-1"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 2</div>
  <ul class="area-list" id="lista-area-2"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 3</div>
  <ul class="area-list" id="lista-area-3"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 4</div>
  <ul class="area-list" id="lista-area-4"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 5</div>
  <ul class="area-list" id="lista-area-5"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 6</div>
  <ul class="area-list" id="lista-area-6"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 7</div>
  <ul class="area-list" id="lista-area-7"></ul>
</div>
    <div class="area-container">
  <div class="area-box">Área 8</div>
  <ul class="area-list" id="lista-area-8"></ul>
</div>
  </div>
</div>



  <script>
    const competidores = [];

    const tbody = document.getElementById("tbody");
    const resumen = document.getElementById("resumen");
    const busqueda = document.getElementById("busqueda");

    function renderTabla(filtro = "") {
      tbody.innerHTML = "";
      let acreditados = 0;

      competidores.forEach(comp => {
        const match = filtro === "" || Object.values(comp).some(val =>
          String(val).toLowerCase().includes(filtro.toLowerCase())
        );

        if (!match) return;

        const tr = document.createElement("tr");
        if (comp.acreditado) {
          tr.classList.add("acreditado");
          acreditados++;
        }

        tr.innerHTML = `
          <td>${comp.id}</td>
          <td contenteditable="true">${comp.nombre}</td>
          <td contenteditable="true">${comp.peso}</td>
          <td contenteditable="true">${comp.altura}</td>
          <td contenteditable="true">${comp.hds}</td>
          <td contenteditable="true">${comp.pdr}</td>
          <td contenteditable="true">${comp.coach}</td>
          <td>
            <select ${comp.acreditado ? "disabled" : ""}>
              <option value="">-</option>
              ${[...Array(8)].map((_, i) => `<option value="${i+1}">Área ${i+1}</option>`).join("")}
            </select>

          </td>
          <td>
            <button ${comp.acreditado ? "disabled" : ""} onclick="acreditar(${comp.id}, this)">Acreditar</button>
          </td>
        `;

        tbody.appendChild(tr);
      });

      resumen.textContent = `Acreditados: ${acreditados} / ${competidores.length}`;
    }

function acreditar(id, btn) {
  const row = btn.closest("tr");
  const areaSelect = row.querySelector("select");
  const areaSeleccionada = areaSelect.value;

  if (!areaSeleccionada) {
    alert("Seleccioná un N° de Área antes de acreditar.");
    return;
  }

  const comp = competidores.find(c => c.id === id);
  if (comp) {
    comp.acreditado = true;
    comp.area = areaSeleccionada;

    agregarAListaDeArea(comp);
    renderTabla(busqueda.value);
  }
}


    busqueda.addEventListener("input", () => {
      renderTabla(busqueda.value);
    });

//    renderTabla(); --> sera esta?

function mostrarSeccion(id) {
  document.getElementById("acreditaciones-section").style.display = id === "acreditaciones" ? "block" : "none";
  document.getElementById("areas-section").style.display = id === "areas" ? "block" : "none";
}


function agregarAListaDeArea(comp) {
  const ul = document.getElementById(`lista-area-${comp.area}`);
  const li = document.createElement("li");
  li.textContent = `${comp.nombre} - ${comp.peso}kg - ${comp.altura}cm`;
  ul.appendChild(li);
}



async function importarDesdeSpreadsheet() {
const sheetURL = prompt("Pegá el link de tu Google Spreadsheet (modo público):");


  if (!sheetURL) return;

  const match = sheetURL.match(/spreadsheets\/d\/([a-zA-Z0-9-_]+)/);
  if (!match) {
    alert("URL inválida");
    return;
  }

  const sheetId = match[1];
  const url = `https://opensheet.vercel.app/${sheetId}/Hoja1`; 


  try {
    const res = await fetch(url);
    const datos = await res.json();

    competidores.length = 0; // limpiamos los actuales

    datos.forEach((fila, i) => {
      competidores.push({
        id: parseInt(fila["N°"]) || i + 1,
        nombre: fila["Nombre y apellido"],
        peso: fila["Peso"],
        altura: fila["Altura"],
        hds: fila["HdS"],
        pdr: fila["PdR"],
        coach: fila["Coach"],
        acreditado: false,
        area: ""
      });
    });

    renderTabla();
    alert("Datos importados con éxito");
  } catch (e) {
    console.error("Error al cargar datos", e);
    alert("Error al importar. Verificá el enlace y que la hoja sea pública.");
  }
}



  </script>

</body>
</html>
